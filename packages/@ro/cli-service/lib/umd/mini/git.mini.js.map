{"version":3,"file":"git.mini.js","sources":["../../../src/git.ts"],"sourcesContent":["import shelljs from 'shelljs';\r\n\r\ntype ShellExecResult = { code: number, stdout: string, stderr: string }\r\n\r\n/** current work path exists a git repo */\r\nexport const existGitRepo = (workPath: string): Promise<boolean> =>\r\n  new Promise((resolve) => {\r\n    shelljs.exec(\r\n      'git status',\r\n      { cwd: workPath, silent: true },\r\n      (code) => resolve(code === 0)\r\n    );\r\n  });\r\n\r\nconst factoryGitShell = (workPath: string, cmd: string): Promise<ShellExecResult> => new Promise(resolve => {\r\n  shelljs.exec(\r\n    cmd,\r\n    { cwd: workPath, silent: true },\r\n    (code, stdout, stderr) => resolve({ code, stdout, stderr })\r\n  )\r\n});\r\n\r\n/** git branch --show-current */\r\nexport const gitBranchCurrent = async (workPath: string) => {\r\n  const { code, stdout, stderr } = await factoryGitShell(workPath, 'git branch --show-current');\r\n  if (code === 0) return stdout.trim();\r\n\r\n  console.log(stderr);\r\n  process.exit(1);\r\n};\r\n\r\nexport const gitRemoveV = async (workPath: string) => factoryGitShell(workPath, 'git remote -v');\r\n\r\n/** get local git origin */\r\nexport const gitLocalOriginURI = async (workPath: string) => {\r\n  const { code, stderr, stdout } = await gitRemoveV(workPath);\r\n  if (code !== 0) {\r\n    console.log(stderr);\r\n    process.exit(1);\r\n  }\r\n\r\n  const gitOrigin = stdout.split(' ')[0].split('\\t')[1];\r\n  return gitOrigin;\r\n};\r\n\r\n"],"names":["factoryGitShell","workPath","cmd","Promise","resolve","shelljs","exec","cwd","silent","code","stdout","stderr","gitRemoveV","async","trim","console","log","process","exit","split"],"mappings":"6WAcMA,EAAkB,CAACC,EAAkBC,IAA0C,IAAIC,SAAQC,IAC/FC,UAAQC,KACNJ,EACA,CAAEK,IAAKN,EAAUO,QAAQ,IACzB,CAACC,EAAMC,EAAQC,IAAWP,EAAQ,CAAEK,KAAAA,EAAMC,OAAAA,EAAQC,OAAAA,SAazCC,EAAaC,MAAAA,GAA4Bb,EAAgBC,EAAU,gCA1BnDA,GAC3B,IAAIE,SAASC,IACXC,UAAQC,KACN,aACA,CAAEC,IAAKN,EAAUO,QAAQ,IACxBC,GAASL,EAAiB,IAATK,2BAaQI,MAAAA,UACxBJ,KAAEA,EAAFC,OAAQA,EAARC,OAAgBA,SAAiBX,EAAgBC,EAAU,gCACpD,IAATQ,EAAY,OAAOC,EAAOI,OAE9BC,QAAQC,IAAIL,GACZM,QAAQC,KAAK,wBAMkBL,MAAAA,UACzBJ,KAAEA,EAAFE,OAAQA,EAARD,OAAgBA,SAAiBE,EAAWX,GACrC,IAATQ,IACFM,QAAQC,IAAIL,GACZM,QAAQC,KAAK,WAGGR,EAAOS,MAAM,KAAK,GAAGA,MAAM,MAAM"}