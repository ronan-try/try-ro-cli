{"version":3,"file":"index.mini.js","sources":["../../../src/git.ts"],"sourcesContent":["import shelljs from 'shelljs';\n\ntype ShellExecResult = { code: number, stdout: string, stderr: string }\n\n/** current work path exists a git repo */\nexport const existGitRepo = (workPath: string): Promise<boolean> =>\n  new Promise((resolve) => {\n    shelljs.exec(\n      'git status',\n      { cwd: workPath, silent: true },\n      (code) => resolve(code === 0)\n    );\n  });\n\nconst factoryGitShell = (workPath: string, cmd: string): Promise<ShellExecResult> => new Promise(resolve => {\n  shelljs.exec(\n    cmd,\n    { cwd: workPath, silent: true },\n    (code, stdout, stderr) => resolve({ code, stdout, stderr })\n  )\n});\n\n/** git branch --show-current */\nexport const gitBranchCurrent = async (workPath: string) => {\n  const { code, stdout, stderr } = await factoryGitShell(workPath, 'git branch --show-current');\n  if (code === 0) return stdout.trim();\n\n  console.log(stderr);\n  process.exit(1);\n};\n\nexport const gitRemoveV = async (workPath: string) => factoryGitShell(workPath, 'git remote -v');\n\n/** get local git origin */\nexport const gitLocalOriginURI = async (workPath: string) => {\n  const { code, stderr, stdout } = await gitRemoveV(workPath);\n  if (code !== 0) {\n    console.log(stderr);\n    process.exit(1);\n  }\n\n  const gitOrigin = stdout.split(' ')[0].split('\\t')[1];\n  return gitOrigin;\n};\n\n"],"names":["factoryGitShell","workPath","cmd","Promise","resolve","shelljs","exec","cwd","silent","code","stdout","stderr","gitRemoveV","async","trim","console","log","process","exit","split"],"mappings":"+WAcMA,EAAkB,CAACC,EAAkBC,IAA0C,IAAIC,SAAQC,IAC/FC,UAAQC,KACNJ,EACA,CAAEK,IAAKN,EAAUO,QAAQ,IACzB,CAACC,EAAMC,EAAQC,IAAWP,EAAQ,CAAEK,KAAAA,EAAMC,OAAAA,EAAQC,OAAAA,SAazCC,EAAaC,MAAAA,GAA4Bb,EAAgBC,EAAU,gCA1BnDA,GAC3B,IAAIE,SAASC,IACXC,UAAQC,KACN,aACA,CAAEC,IAAKN,EAAUO,QAAQ,IACxBC,GAASL,EAAiB,IAATK,2BAaQI,MAAAA,UACxBJ,KAAEA,EAAFC,OAAQA,EAARC,OAAgBA,SAAiBX,EAAgBC,EAAU,gCACpD,IAATQ,EAAY,OAAOC,EAAOI,OAE9BC,QAAQC,IAAIL,GACZM,QAAQC,KAAK,wBAMkBL,MAAAA,UACzBJ,KAAEA,EAAFE,OAAQA,EAARD,OAAgBA,SAAiBE,EAAWX,GACrC,IAATQ,IACFM,QAAQC,IAAIL,GACZM,QAAQC,KAAK,WAGGR,EAAOS,MAAM,KAAK,GAAGA,MAAM,MAAM"}